From 1e4b0640abf773901d494ad6fc42678a992948a1 Mon Sep 17 00:00:00 2001
From: root <you@example.com>
Date: Wed, 6 Dec 2023 15:10:39 +0200
Subject: [PATCH] fuzzbuzz monitor command was added to qemu

---
 hmp-commands.hx    | 27 ++++++++++++++++++++++++
 monitor/hmp-cmds.c | 23 ++++++++++++++++++++
 monitor/qmp-cmds.c | 33 +++++++++++++++++++++++++++++
 qapi/misc.json     | 52 ++++++++++++++++++++++++++++++++++++++++++++++
 4 files changed, 135 insertions(+)

diff --git a/hmp-commands.hx b/hmp-commands.hx
index 765349e..81d2101 100644
--- a/hmp-commands.hx
+++ b/hmp-commands.hx
@@ -6,6 +6,33 @@ HXCOMM monitor commands
 HXCOMM HXCOMM can be used for comments, discarded from both rST and C.
 
 
+   {
+       .name       = "fuzzbuzz",
+       .args_type  = "value:i?",
+       .params     = "fuzzbuzz [value]",
+       .help       = "Print res to the standard output",
+       .cmd        = hmp_fuzzbuzz,
+   },
+
+SRST
+``fuzzbuzz`` *value*
+  Print result to the standard output
+ERST
+
+   {
+       .name       = "hello-world",
+       .args_type  = "message:s?",
+       .params     = "hello-world [message]",
+       .help       = "Print message to the standard output",
+       .cmd        = hmp_hello_world,
+   },
+
+SRST
+``hello_world`` *message*
+  Print message to the standard output
+ERST
+
+
     {
         .name       = "help|?",
         .args_type  = "name:S?",
diff --git a/monitor/hmp-cmds.c b/monitor/hmp-cmds.c
index 871898a..787df3e 100644
--- a/monitor/hmp-cmds.c
+++ b/monitor/hmp-cmds.c
@@ -57,6 +57,29 @@ strList *hmp_split_at_comma(const char *str)
     return res;
 }
 
+void hmp_hello_world(Monitor *mon, const QDict *qdict)
+{
+    const char *message = qdict_get_try_str(qdict, "message");
+    Error *err = NULL;
+
+    qmp_hello_world(!!message, message, &err);
+    if (hmp_handle_error(mon, err)) {
+        return;
+    }
+}
+
+void hmp_fizzbuzz(Monitor *mon, const QDict *qdict)
+{
+    int64_t max = qdict_get_try_int(qdict, "max", 10);
+    Error *err = NULL;
+
+
+    qmp_fizzbuzz(!!max, max, &err);
+    if (hmp_handle_error(mon, err)) {
+        return;
+    }
+}
+
 void hmp_info_name(Monitor *mon, const QDict *qdict)
 {
     NameInfo *info;
diff --git a/monitor/qmp-cmds.c b/monitor/qmp-cmds.c
index b0f948d..db9a21f 100644
--- a/monitor/qmp-cmds.c
+++ b/monitor/qmp-cmds.c
@@ -41,6 +41,39 @@ NameInfo *qmp_query_name(Error **errp)
     return info;
 }
 
+void qmp_fizzbuzz(int64_t num, Error **errp)
+{
+    char *out = NULL;
+
+    if (num % 3 == 0 && num % 5 == 0)
+    {
+        out = "fizzbuzz";
+    }
+    else if (num % 3 == 0)
+    {
+        out = "fuzz";
+    }
+    else if (num % 5 == 0)
+    {
+       out = "buzz";
+    }
+    else
+    {
+        itoa(num, out, 10);
+    }
+    return out;
+}
+
+
+void qmp_hello_world(const char *message, Error **errp)
+{
+    if (message) {
+        printf("%s\n", message);
+    } else {
+        printf("Hello, world\n");
+    }
+}
+
 void qmp_quit(Error **errp)
 {
     shutdown_action = SHUTDOWN_ACTION_POWEROFF;
diff --git a/qapi/misc.json b/qapi/misc.json
index cda2eff..864bc35 100644
--- a/qapi/misc.json
+++ b/qapi/misc.json
@@ -8,6 +8,58 @@
 
 { 'include': 'common.json' }
 
+
+##
+# @fizzbuzz:
+#
+# Print a client provided string to the standard output stream.
+#
+# @value: int to be return
+#
+# Returns: Nothing on success.
+#
+#
+# Since: <next qemu stable release, eg. 1.0>
+##
+{ 'command': 'fizzbuzz',
+  'data': { 'value': 'int' }}
+
+
+##
+# @hello-world:
+#
+# Print a client provided string to the standard output stream.
+#
+# @message: string to be printed
+#
+# Returns: Nothing on success.
+#
+# Notes: if @message is not provided, the "Hello, world" string will
+#        be printed instead
+#
+# Since: <next qemu stable release, eg. 1.0>
+##
+{ 'command': 'hello-world', 'data': { '*message': 'str' } }
+
+
+##
+# @fizzbuzz
+#
+# Fizzbuzz command will print the number it receives as a parameter.
+# But for multiples of three print “fizz” instead of the number
+# and for the multiples of five print “buzz”.
+#
+# @value: int to be return
+#
+# Returns: Nothing on success.
+#
+# Since: 8.1.3
+##
+{ 'command': 'fizzbuzz',
+  'data':    { 'value': 'int' },
+  'returns': 'str' }
+
+
 ##
 # @add_client:
 #
-- 
2.34.1
